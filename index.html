<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SwissPark - Le futur du parking en Suisse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --sp-pink: #E6007E; --sp-dark: #2D2D2D; }
        body { font-family: 'Montserrat', sans-serif; background: #f8f9fa; overscroll-behavior: none; overflow: hidden; }
        #map { height: 100vh; width: 100%; z-index: 0; }
        
        .glass-panel { 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(10px); 
            border-radius: 20px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .btn-pink { background: var(--sp-pink); color: white; font-weight: 800; transition: all 0.3s; border: none; cursor: pointer; }
        .btn-pink:active { transform: scale(0.95); }
        
        .bottom-sheet { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: white; border-radius: 32px 32px 0 0; z-index: 1000; 
            transform: translateY(100%); transition: transform 0.5s cubic-bezier(0.32, 0.72, 0, 1);
            padding: 1.5rem; box-shadow: 0 -10px 40px rgba(0,0,0,0.08);
        }
        .bottom-sheet.active { transform: translateY(0); }
        
        .timer-container { position: relative; width: 260px; height: 260px; margin: 1.5rem auto; }
        .timer-wheel-svg { transform: rotate(-90deg); cursor: grab; }
        
        .nav-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; height: 85px; 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(15px);
            border-top: 1px solid rgba(0,0,0,0.05); 
            display: flex; justify-content: space-around; align-items: center; z-index: 1001;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #9ca3af; text-decoration: none; font-weight: 700; gap: 5px; text-transform: uppercase; letter-spacing: 0.5px; }
        .nav-item.active { color: var(--sp-pink); }
        
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 2000; align-items: flex-end; justify-content: center; backdrop-filter: blur(4px); }
        .modal-content { background: white; width: 100%; max-width: 500px; border-radius: 32px 32px 0 0; padding: 2rem; position: relative; }
        
        .search-container { position: fixed; top: 20px; left: 20px; right: 20px; z-index: 100; }
        
        .custom-marker { transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .custom-marker:hover { transform: scale(1.2); z-index: 1000 !important; }

        .parking-active-bg { background: linear-gradient(180deg, #E6007E 0%, #B30062 100%); color: white; }
    </style>
</head>
<body>

    <div id="map"></div>

    <!-- Floating Search & Info -->
    <div class="search-container flex flex-col gap-3">
        <div class="glass-panel p-4 flex items-center gap-3">
            <i class="fas fa-search text-gray-400 text-lg"></i>
            <input id="zone-search" type="text" placeholder="Où voulez-vous vous garer ?" class="bg-transparent border-none outline-none font-semibold text-gray-800 w-full text-base">
            <div class="h-6 w-px bg-gray-200"></div>
            <button class="text-pink-600"><i class="fas fa-camera text-lg"></i></button>
        </div>
        
        <!-- Optional: Quick filters -->
        <div class="flex gap-2 overflow-x-auto pb-2 no-scrollbar">
            <div class="glass-panel px-4 py-2 whitespace-nowrap text-xs font-bold text-gray-600 flex items-center gap-2">
                <i class="fas fa-bolt text-yellow-500"></i> Bornes de recharge
            </div>
            <div class="glass-panel px-4 py-2 whitespace-nowrap text-xs font-bold text-gray-600 flex items-center gap-2">
                <i class="fas fa-wheelchair text-blue-500"></i> Accessibilité
            </div>
        </div>
    </div>

    <!-- Actions Buttons -->
    <div class="fixed right-5 bottom-[180px] flex flex-col gap-3 z-50">
        <button onclick="centerMap()" class="bg-white w-14 h-14 rounded-full shadow-xl flex items-center justify-center text-gray-600 active:scale-95 transition-all">
            <i class="fas fa-location-arrow text-xl"></i>
        </button>
        <button onclick="zoomIn()" class="bg-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center text-gray-400 active:scale-95 transition-all">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- Selection Bottom Sheet (Hidden by default) -->
    <div id="initial-sheet" class="bottom-sheet">
        <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6" onclick="closeSheet()"></div>
        <div class="flex justify-between items-start mb-2">
            <div>
                <h3 id="current-zone-name" class="text-2xl font-black leading-tight">Zone 1001</h3>
                <p class="text-gray-400 font-bold flex items-center gap-1">
                    <i class="fas fa-map-marker-alt text-xs"></i> Lausanne, Riponne
                </p>
            </div>
            <div id="current-zone-price" class="text-right font-black text-gray-800">2.50 CHF/h</div>
        </div>

        <div class="timer-container" id="wheel-container">
            <svg viewBox="0 0 260 260" class="timer-wheel-svg" id="timer-wheel">
                <circle cx="130" cy="130" r="110" fill="none" stroke="#f3f4f6" stroke-width="20" />
                <circle id="progress-bar" cx="130" cy="130" r="110" fill="none" stroke="#E6007E" stroke-width="20" stroke-dasharray="691" stroke-dashoffset="691" stroke-linecap="round" />
                <circle id="drag-handle" cx="130" cy="20" r="18" fill="white" stroke="#E6007E" stroke-width="4" style="filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));" />
            </svg>
            <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                <span id="display-time" class="text-5xl font-black text-gray-800">01:00</span>
                <span class="text-[10px] font-bold text-gray-400 mt-1 uppercase tracking-widest">Durée prévue</span>
            </div>
        </div>

        <div class="bg-gray-50 p-4 rounded-2xl flex items-center justify-between mb-6 border border-gray-100">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center text-gray-500">
                    <i class="fas fa-car"></i>
                </div>
                <div id="selected-vehicle-display" class="font-bold text-gray-800">GE 123 456</div>
            </div>
            <button onclick="openModal('vehicle-modal')" class="text-pink-600 font-bold text-sm">Changer</button>
        </div>

        <button id="start-btn" onclick="startParking()" class="btn-pink w-full py-5 rounded-2xl font-black uppercase text-xl shadow-lg shadow-pink-200">
            Démarrer le stationnement
        </button>
    </div>

    <!-- Navigation Bar -->
    <nav class="nav-bar">
        <a href="#" class="nav-item active">
            <i class="fas fa-map-marked-alt text-2xl"></i>
            <span>Carte</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-history text-2xl"></i>
            <span>Activité</span>
        </a>
        <a href="#" class="nav-item" onclick="openModal('vehicle-modal')">
            <i class="fas fa-car text-2xl"></i>
            <span>Véhicules</span>
        </a>
        <a href="#" class="nav-item" onclick="openModal('auth-modal')">
            <i class="fas fa-user-circle text-2xl"></i>
            <span>Compte</span>
        </a>
    </nav>

    <!-- Modals -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-3xl font-black mb-2">Compte</h3>
            <p class="text-gray-500 mb-8 font-semibold">Connectez-vous pour synchroniser vos données.</p>
            <form id="phone-form" class="space-y-4">
                <div class="bg-gray-50 p-5 rounded-2xl border border-gray-100 flex items-center gap-3">
                    <img src="https://flagcdn.com/ch.svg" class="w-6 h-4 rounded-sm" alt="CH">
                    <input type="tel" id="phone-number" placeholder="+41 79 000 00 00" class="bg-transparent border-none outline-none font-bold text-xl text-gray-800 w-full" required>
                </div>
                <button type="submit" class="btn-pink w-full py-5 rounded-2xl font-black uppercase text-lg">Se connecter</button>
            </form>
            <button onclick="closeModal('auth-modal')" class="w-full mt-4 font-bold text-gray-400">Annuler</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- Map Setup ---
        const map = L.map('map', { zoomControl: false, attributionControl: false }).setView([46.5197, 6.6323], 15);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

        const parkingSpots = [
            { id: 1001, name: "Lausanne Riponne", pos: [46.5237, 6.6323], price: 2.50 },
            { id: 1002, name: "Lausanne Gare", pos: [46.5167, 6.6293], price: 3.00 },
            { id: 2001, name: "Genève Centre", pos: [46.2044, 6.1432], price: 4.50 }
        ];

        parkingSpots.forEach(spot => {
            const markerHtml = `<div class="bg-[#E6007E] text-white px-3 py-1 rounded-full font-black shadow-lg text-sm border-2 border-white">${spot.price.toFixed(2)}</div>`;
            const icon = L.divIcon({ className: 'custom-marker', html: markerHtml, iconSize: [50, 30], iconAnchor: [25, 15] });
            L.marker(spot.pos, { icon }).addTo(map).on('click', () => openParkingSheet(spot));
        });

        function openParkingSheet(spot) {
            document.getElementById('current-zone-name').innerText = spot.name;
            document.getElementById('current-zone-price').innerText = `${spot.price.toFixed(2)} CHF/h`;
            document.getElementById('initial-sheet').classList.add('active');
        }

        function closeSheet() {
            document.getElementById('initial-sheet').classList.remove('active');
        }

        function centerMap() { map.flyTo([46.5197, 6.6323], 15); }
        function zoomIn() { map.setZoom(map.getZoom() + 1); }

        // --- Wheel Logic ---
        const wheel = document.getElementById('timer-wheel');
        const handle = document.getElementById('drag-handle');
        const progress = document.getElementById('progress-bar');
        const display = document.getElementById('display-time');
        const r = 110;
        let isDragging = false;

        function updateWheel(e) {
            const rect = wheel.getBoundingClientRect();
            const cx = rect.left + rect.width / 2;
            const cy = rect.top + rect.height / 2;
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - cx;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - cy;
            let rad = Math.atan2(y, x);
            let deg = rad * (180 / Math.PI) + 90;
            if (deg < 0) deg += 360;
            
            handle.setAttribute('cx', 130 + r * Math.cos(rad));
            handle.setAttribute('cy', 130 + r * Math.sin(rad));
            progress.style.strokeDashoffset = 691 - (deg / 360) * 691;
            
            let hours = Math.max(0.5, Math.round((deg / 360) * 12 * 2) / 2);
            let h = Math.floor(hours);
            let m = (hours % 1) * 60;
            display.innerText = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
        }

        wheel.addEventListener('mousedown', () => isDragging = true);
        window.addEventListener('mouseup', () => isDragging = false);
        window.addEventListener('mousemove', (e) => isDragging && updateWheel(e));
        wheel.addEventListener('touchstart', (e) => { isDragging = true; e.preventDefault(); });
        window.addEventListener('touchend', () => isDragging = false);
        window.addEventListener('touchmove', (e) => isDragging && updateWheel(e));

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    </script>
</body>
</html>
