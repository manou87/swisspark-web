<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SwissPark – Votre parking en Suisse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --sp-pink: #E6007E; --sp-dark: #2D2D2D; --sp-twint: #000; }
        body { font-family: 'Montserrat', sans-serif; background: #f8f9fa; overscroll-behavior: none; overflow: hidden; }
        #map { height: 100vh; width: 100%; z-index: 0; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 24px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05); }
        .btn-pink { background: var(--sp-pink); color: white; font-weight: 800; transition: 0.3s; border: none; }
        .btn-pink:active { transform: scale(0.95); }
        #auth-overlay { position: fixed; inset: 0; background: white; z-index: 5000; display: flex; flex-direction: column; padding: 2rem; }
        .bottom-sheet { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-radius: 32px 32px 0 0; z-index: 1000; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1); padding: 1.5rem; box-shadow: 0 -10px 40px rgba(0,0,0,0.1); }
        .bottom-sheet.active { transform: translateY(0); }
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; height: 85px; background: white; border-top: 1px solid #f0f0f0; display: flex; justify-content: space-around; align-items: center; z-index: 1001; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #9ca3af; font-weight: 700; gap: 4px; text-transform: uppercase; }
        .nav-item.active { color: var(--sp-pink); }
        .price-tag { background: var(--sp-pink); color: white; padding: 4px 12px; border-radius: 20px; font-weight: 800; font-size: 14px; border: 2px solid white; box-shadow: 0 4px 12px rgba(230,0,126,0.3); }
        .twint-btn { background: var(--sp-twint); color: white; border-radius: 16px; padding: 1.2rem; font-weight: 800; width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .hidden { display: none !important; }
        .plate-input { font-family: 'Courier New', monospace; letter-spacing: 2px; text-transform: uppercase; border: 2px solid #ddd; border-radius: 8px; padding: 10px; font-size: 1.2rem; text-align: center; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="auth-overlay">
        <div class="flex-1 flex flex-col justify-center max-w-md mx-auto w-full">
            <div class="mb-8 text-center">
                <h1 class="text-3xl font-black text-[#E6007E] mb-2 tracking-tight">SwissPark</h1>
                <p class="text-gray-500 font-semibold">Le futur du parking en Suisse</p>
            </div>
            <div id="reg-form" class="space-y-4">
                <input id="reg-name" type="text" placeholder="Nom complet" class="w-full p-4 bg-gray-100 rounded-2xl border-none font-bold">
                <input id="reg-phone" type="tel" placeholder="+41 7x xxx xx xx" class="w-full p-4 bg-gray-100 rounded-2xl border-none font-bold">
                <input id="reg-email" type="email" placeholder="Email" class="w-full p-4 bg-gray-100 rounded-2xl border-none font-bold">
                <input id="reg-pass" type="password" placeholder="Mot de passe" class="w-full p-4 bg-gray-100 rounded-2xl border-none font-bold">
                <label class="flex items-start gap-3 p-2 cursor-pointer">
                    <input type="checkbox" id="reg-terms" class="mt-1 w-5 h-5 accent-[#E6007E]">
                    <span class="text-xs text-gray-500 font-medium">J'accepte les conditions générales de SwissPark.</span>
                </label>
                <button onclick="handleRegister()" class="w-full btn-pink p-5 rounded-2xl shadow-xl mt-4 text-lg">S'inscrire et Commencer</button>
            </div>
        </div>
    </div>
    <div id="app-content" class="hidden">
        <div id="map"></div>
        <div class="fixed top-12 left-4 right-4 z-[1002]">
            <div class="glass-panel p-4 flex items-center gap-3">
                <i class="fas fa-search text-gray-400"></i>
                <input type="text" placeholder="Où voulez-vous vous garer ?" class="bg-transparent border-none w-full font-bold focus:outline-none">
            </div>
        </div>
        <button onclick="toggleVehicleModal(true)" class="fixed top-32 right-4 z-[1002] glass-panel p-3 flex items-center gap-2">
            <i class="fas fa-car text-[#E6007E]"></i>
            <span id="active-vehicle-label" class="text-xs font-black uppercase">Véhicule</span>
        </button>
        <div id="booking-sheet" class="bottom-sheet pb-32">
            <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6"></div>
            <div id="booking-details">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 id="spot-title" class="text-2xl font-black mb-1">Place de Parc</h2>
                        <p id="spot-address" class="text-gray-400 font-bold flex items-center gap-2">
                            <i class="fas fa-location-dot"></i> Lausanne, Suisse
                        </p>
                    </div>
                    <div id="spot-badge" class="px-3 py-1 rounded-lg text-xs font-black uppercase">Extérieur</div>
                </div>
                <div class="grid grid-cols-4 gap-2 mb-6 overflow-x-auto no-scrollbar">
                    <div onclick="setPricingType('hr')" class="p-3 min-w-[80px] rounded-xl border-2 border-[#E6007E] bg-pink-50 cursor-pointer text-center price-option" id="price-hr">
                        <p class="text-[8px] font-bold text-[#E6007E]">HEURE</p>
                        <p class="text-sm font-black">3.-</p>
                    </div>
                    <div onclick="setPricingType('day')" class="p-3 min-w-[80px] rounded-xl border-2 border-transparent bg-gray-50 cursor-pointer text-center price-option" id="price-day">
                        <p class="text-[8px] font-bold text-gray-400">JOUR</p>
                        <p class="text-sm font-black">15.-</p>
                    </div>
                    <div onclick="setPricingType('week')" class="p-3 min-w-[80px] rounded-xl border-2 border-transparent bg-gray-50 cursor-pointer text-center price-option" id="price-week">
                        <p class="text-[8px] font-bold text-gray-400">SEMAINE</p>
                        <p class="text-sm font-black">80.-</p>
                    </div>
                    <div onclick="setPricingType('month')" class="p-3 min-w-[80px] rounded-xl border-2 border-transparent bg-gray-50 cursor-pointer text-center price-option" id="price-month">
                        <p class="text-[8px] font-bold text-gray-400">MOIS</p>
                        <p class="text-sm font-black">250.-</p>
                    </div>
                </div>
                <div class="mb-8">
                    <div class="flex justify-between font-black text-sm mb-2">
                        <span>DURÉE</span>
                        <span id="current-duration">1 Heure</span>
                    </div>
                    <input type="range" min="1" max="24" value="1" id="duration-slider" class="w-full accent-[#E6007E]" oninput="updateTotal()">
                </div>
                <div class="space-y-4">
                    <div class="flex justify-between items-center text-xl font-black p-2">
                        <span>TOTAL</span>
                        <span id="final-total">3.00 CHF</span>
                    </div>
                    <p class="text-[10px] text-gray-400 text-center font-bold px-4">Commission 10% incluse.</p>
                    <button onclick="processPayment()" class="twint-btn">
                        <i class="fas fa-qrcode"></i> PAYER AVEC TWINT
                    </button>
                </div>
            </div>
        </div>
        <div id="vehicle-modal" class="fixed inset-0 bg-black/50 z-[2000] flex items-end hidden">
            <div class="w-full glass-panel rounded-t-[40px] p-8 bg-white">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-black">Mon Véhicule</h3>
                    <button onclick="toggleVehicleModal(false)"><i class="fas fa-times text-xl"></i></button>
                </div>
                <form id="vehicle-form" class="space-y-4">
                    <input id="veh-plate" type="text" placeholder="VD 123 456" class="plate-input w-full" required>
                    <div class="grid grid-cols-2 gap-4">
                        <input id="veh-type" type="text" placeholder="Modèle" class="p-4 bg-gray-100 rounded-2xl font-bold">
                        <input id="veh-color" type="text" placeholder="Couleur" class="p-4 bg-gray-100 rounded-2xl font-bold">
                    </div>
                    <button type="submit" class="w-full btn-pink p-5 rounded-2xl text-lg mt-4">Sauvegarder</button>
                </form>
            </div>
        </div>
        <div class="nav-bar">
            <div class="nav-item active"><i class="fas fa-map-location-dot text-2xl"></i><span>Explorer</span></div>
            <div class="nav-item"><i class="fas fa-history text-2xl"></i><span>Activités</span></div>
            <div class="nav-item"><i class="fas fa-wallet text-2xl"></i><span>Paiement</span></div>
            <div class="nav-item"><i class="fas fa-user text-2xl"></i><span>Profil</span></div>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let map, user = JSON.parse(localStorage.getItem('sp_user')), vehicle = JSON.parse(localStorage.getItem('sp_vehicle')), selectedSpot = null, pricingType = 'hr', duration = 1;
        document.addEventListener('DOMContentLoaded', () => { if (user) showApp(); });
        function handleRegister() {
            const n = document.getElementById('reg-name').value, p = document.getElementById('reg-phone').value, t = document.getElementById('reg-terms').checked;
            if (!n || !p || !t) { alert("Veuillez tout remplir."); return; }
            user = { n, p }; localStorage.setItem('sp_user', JSON.stringify(user)); showApp();
        }
        function showApp() {
            document.getElementById('auth-overlay').classList.add('hidden');
            document.getElementById('app-content').classList.remove('hidden');
            initMap(); if (vehicle) updateVehicleLabel();
        }
        function initMap() {
            map = L.map('map', { zoomControl: false }).setView([46.5197, 6.6323], 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
            const spots = [{ id: 1, pos: [46.521, 6.634], title: "Quartier St-François", type: "Extérieur", covered: false }, { id: 2, pos: [46.518, 6.630], title: "Gare de Lausanne", type: "Couvert", covered: true }];
            spots.forEach(s => {
                const marker = L.divIcon({ className: 'custom-marker', html: `<div class="price-tag">${s.covered ? '6.-' : '3.-'}</div>` });
                L.marker(s.pos, { icon: marker }).addTo(map).on('click', () => openBooking(s));
            });
        }
        function openBooking(s) {
            selectedSpot = s; document.getElementById('spot-title').innerText = s.title;
            document.getElementById('spot-badge').innerText = s.type;
            document.getElementById('spot-badge').className = s.covered ? 'bg-purple-50 text-purple-600 px-3 py-1 rounded-lg text-xs font-black uppercase' : 'bg-blue-50 text-blue-600 px-3 py-1 rounded-lg text-xs font-black uppercase';
            setPricingType('hr');
            document.getElementById('booking-sheet').classList.add('active');
        }
        function setPricingType(t) {
            pricingType = t;
            ['hr','day','week','month'].forEach(id => {
                const el = document.getElementById('price-'+id);
                el.className = pricingType === id ? 'p-3 min-w-[80px] rounded-xl border-2 border-[#E6007E] bg-pink-50 cursor-pointer text-center' : 'p-3 min-w-[80px] rounded-xl border-2 border-transparent bg-gray-50 cursor-pointer text-center';
            });
            document.getElementById('duration-slider').max = (t === 'hr' ? 24 : 30);
            updateTotal();
        }
        function updateTotal() {
            duration = parseInt(document.getElementById('duration-slider').value);
            let base = 3; let unit = "Heure";
            if (pricingType === 'day') { base = 15; unit = "Jour"; }
            if (pricingType === 'week') { base = 80; unit = "Semaine"; }
            if (pricingType === 'month') { base = 250; unit = "Mois"; }
            if (selectedSpot && selectedSpot.covered) base *= 2;
            if (duration > 1) unit += (pricingType === 'month' ? "" : "s");
            document.getElementById('current-duration').innerText = `${duration} ${unit}`;
            document.getElementById('final-total').innerText = `${(base * duration).toFixed(2)} CHF`;
        }
        function toggleVehicleModal(s) { document.getElementById('vehicle-modal').classList.toggle('hidden', !s); }
        document.getElementById('vehicle-form').onsubmit = (e) => {
            e.preventDefault(); const p = document.getElementById('veh-plate').value;
            if (!p) return; vehicle = { plate: p }; localStorage.setItem('sp_vehicle', JSON.stringify(vehicle));
            updateVehicleLabel(); toggleVehicleLabel(); toggleVehicleModal(false);
        };
        function updateVehicleLabel() { document.getElementById('active-vehicle-label').innerText = vehicle.plate; }
        function processPayment() {
            if (!vehicle) { alert("Ajoutez un véhicule."); toggleVehicleModal(true); return; }
            alert("Simulation TWINT...");
            setTimeout(() => { alert("✅ Payé !"); document.getElementById('booking-sheet').classList.remove('active'); }, 1000);
        }
    </script>
</body>
</html>
