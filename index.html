<!DOCTYPE html><html lang="fr"><head> <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>SwissPark - Connexion</title>
 <script src="https://cdn.tailwindcss.com"></script>
 <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
 <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script></head><body class="bg-gray-50 min-h-screen flex items-center justify-center p-4"> <div class="max-w-md w-full">
 <!-- Logo -->
 <div class="text-center mb-8">
 <h1 class="text-4xl font-bold text-blue-600 mb-2">SwissPark</h1>
 <p class="text-gray-600">Le futur du parking en Suisse</p>
 </div>
 <!-- Carte de connexion -->
 <div class="bg-white rounded-3xl shadow-xl p-8">
 <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Connexion</h2>
 <br> 
 <!-- Formulaire Principal -->
 <div id="loginForm">
 <div class="mb-4">
 <label id="inputLabel" class="block text-sm font-medium text-gray-700 mb-2">T√©l√©phone ou Email</label>
 <input type="text" id="loginInput" 
 placeholder="Ex: 079 123 45 67 ou email@exemple.com"
 class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition">
 </div>
 <!-- Champ Password (cach√© par d√©faut) -->
 <div id="passwordSection" class="mb-4 hidden">
 <label class="block text-sm font-medium text-gray-700 mb-2">Mot de passe</label>
 <input type="password" id="passwordInput" 
 class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition">
 </div>
 <div id="recaptcha-container" class="mb-4"></div>
 <button id="mainButton" onclick="handleLogin()" 
 class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-xl transition duration-200">
 Continuer
 </button>
 </div>
 <!-- Formulaire SMS (cach√©) -->
 <div id="verificationForm" class="hidden">
 <div class="mb-4">
 <label class="block text-sm font-medium text-gray-700 mb-2">Code de v√©rification</label>
 <input type="text" id="verificationCode" placeholder="123456" maxlength="6"
 class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition text-center text-2xl font-bold tracking-widest">
 </div>
 <button onclick="verifyCode()" 
 class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-xl transition duration-200">
 V√©rifier le code
 </button>
 <button onclick="resetUI()" 
 class="w-full mt-2 text-gray-600 hover:text-gray-800 font-medium py-2">
 ‚Üê Retour
 </button>
 </div>
 <!-- Messages -->
 <div id="message" class="mt-4 p-3 rounded-lg hidden"></div>
 </div>
 </div>
 <script>
 // Configuration Firebase
 const firebaseConfig = {
 authDomain: "swisspark-e4c0a.firebaseapp.com",
 projectId: "swisspark-e4c0a",
 apiKey: "AIzaSyB3uDEtxEcwxuRRqItU1G-sn5cAWse-gpc",
 storageBucket: "swisspark-e4c0a.firebasestorage.app",
 messagingSenderId: "852079002086",
 appId: "1:852079002086:web:d9d1f6c4e8b5a3c2d4e5f6"
 };
 firebase.initializeApp(firebaseConfig);
 const auth = firebase.auth();
 auth.languageCode = 'fr';
 let confirmationResult;
 let isPhoneMode = true;
 const loginInput = document.getElementById('loginInput');
 const mainButton = document.getElementById('mainButton');
 const passwordSection = document.getElementById('passwordSection');
 const recaptchaContainer = document.getElementById('recaptcha-container');
 // Logic for auto +41 and mode detection
 loginInput.addEventListener('input', function(e) {
 const val = this.value;
 
 // Detect Email
 if (val.includes('@')) {
 isPhoneMode = false;
 passwordSection.classList.remove('hidden');
 recaptchaContainer.classList.add('hidden');
 mainButton.innerText = "Se connecter";
 return;
 }
 // Detect Phone
 if (/[0-9]/.test(val) || val.startsWith('+')) {
 isPhoneMode = true;
 passwordSection.classList.add('hidden');
 recaptchaContainer.classList.remove('hidden');
 mainButton.innerText = "Envoyer le code SMS";
 // Auto-add +41 if it starts with a digit and doesn't have a prefix
 if (/^[0-9]/.test(val) && !val.startsWith('+')) {
 this.value = '+41 ' + val.replace(/^0/, '');
 }
 }
 });
 function showMessage(text, isError = false) {
 const messageDiv = document.getElementById('message');
 messageDiv.textContent = text;
 messageDiv.className = `mt-4 p-3 rounded-lg ${isError ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`;
 messageDiv.classList.remove('hidden');
 }
 async function handleLogin() {
 const val = loginInput.value.trim();
 if (!val) {
 showMessage('‚ùå Veuillez entrer vos informations', true);
 return;
 }
 if (isPhoneMode) {
 await sendSMS(val);
 } else {
 await loginWithEmail(val);
 }
 }
 async function sendSMS(phoneNumber) {
 // Clean phone number for Firebase (remove spaces)
 const cleanPhone = phoneNumber.replace(/\s/g, '');
 if (cleanPhone.length < 12) {
 showMessage('‚ùå Num√©ro invalide. Format: +41 79 123 45 67', true);
 return;
 }
 try {
 showMessage('üì± Envoi du code SMS...');
 if (!window.recaptchaVerifier) {
 window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
 'size': 'invisible'
 });
 }
 
 confirmationResult = await auth.signInWithPhoneNumber(cleanPhone, window.recaptchaVerifier);
 document.getElementById('loginForm').classList.add('hidden');
 document.getElementById('verificationForm').classList.remove('hidden');
 showMessage('‚úÖ Code SMS envoy√©!');
 } catch (error) {
 showMessage('‚ùå Erreur: ' + error.message, true);
 if (window.recaptchaVerifier) window.recaptchaVerifier.clear();
 }
 }
 async function loginWithEmail(email) {
 const password = document.getElementById('passwordInput').value;
 if (!password) {
 showMessage('‚ùå Veuillez entrer votre mot de passe', true);
 return;
 }
 try {
 showMessage('üîê Connexion...');
 await auth.signInWithEmailAndPassword(email, password);
 redirect();
 } catch (error) {
 showMessage('‚ùå Erreur: ' + error.message, true);
 }
 }
 async function verifyCode() {
 const code = document.getElementById('verificationCode').value;
 try {
 showMessage('üîê V√©rification...');
 await confirmationResult.confirm(code);
 redirect();
 } catch (error) {
 showMessage('‚ùå Code incorrect', true);
 }
 }
 function redirect() {
 showMessage('‚úÖ Connect√©! Redirection...');
 setTimeout(() => {
 window.location.href = '/swisspark-web/dashboard.html';
 }, 1000);
 }
 function resetUI() {
 document.getElementById('verificationForm').classList.add('hidden');
 document.getElementById('loginForm').classList.remove('hidden');
 if (window.recaptchaVerifier) window.recaptchaVerifier.clear();
 }
 </script></body></html>
