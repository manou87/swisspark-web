<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SwissPark - Syst√®me Num√©rique ICP</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
#map { height: 400px; width: 100%; border-radius: 1.5rem; z-index: 1; }
.num-button { background: #f3f4f6; border: 2px solid transparent; transition: all 0.2s; }
.num-button:hover { background: #e5e7eb; border-color: #3b82f6; }
.num-button.active { background: #3b82f6; color: white; border-color: #2563eb; }
.digital-timer { font-family: 'Courier New', Courier, monospace; letter-spacing: 0.1em; }
</style>
</head>
<body class="bg-gray-50 min-h-screen">

<div class="flex flex-col h-screen">
    <!-- Header Num√©rique -->
    <header class="bg-white shadow-sm p-4 flex justify-between items-center z-10">
        <div class="flex items-center gap-2">
            <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold">SP</div>
            <h1 class="text-xl font-bold text-gray-800">SwissPark Digital</h1>
        </div>
        <div class="flex items-center gap-4">
            <span id="userPhone" class="text-sm text-blue-600 font-medium hidden md:block"></span>
            <button onclick="logout()" class="text-sm font-semibold text-gray-500 hover:text-red-600">D√©connexion</button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto p-4 md:p-6 space-y-6">
        
        <!-- Map & Search Section -->
        <div class="relative">
            <div id="map" class="shadow-lg border-2 border-white"></div>
            
            <!-- Search Bar Overlay -->
            <div class="absolute top-4 left-4 right-4 z-[1000] flex gap-2">
                <input type="text" id="searchParking" placeholder="Rechercher une zone ou adresse..." 
                       class="flex-1 px-4 py-3 rounded-xl shadow-xl border-none focus:ring-2 focus:ring-blue-500 outline-none">
                <button class="bg-blue-600 text-white p-3 rounded-xl shadow-xl hover:bg-blue-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Digital Controls Panel -->
        <div class="bg-white rounded-3xl p-6 shadow-xl space-y-6">
            <div class="flex justify-between items-center">
                <h2 class="text-lg font-bold text-gray-800">S√©lection Num√©rique</h2>
                <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold uppercase">Zone 1200</span>
            </div>

            <!-- Digital Time Selector -->
            <div class="grid grid-cols-4 gap-3">
                <button onclick="setDigitalTime(15)" class="num-button py-3 rounded-xl font-bold text-gray-700" id="btn-15">15m</button>
                <button onclick="setDigitalTime(30)" class="num-button py-3 rounded-xl font-bold text-gray-700" id="btn-30">30m</button>
                <button onclick="setDigitalTime(60)" class="num-button py-3 rounded-xl font-bold text-gray-700 active" id="btn-60">1h</button>
                <button onclick="setDigitalTime(120)" class="num-button py-3 rounded-xl font-bold text-gray-700" id="btn-120">2h</button>
            </div>

            <!-- Digital Display -->
            <div class="bg-gray-900 rounded-2xl p-6 text-center shadow-inner">
                <div class="text-xs text-blue-400 mb-1 uppercase tracking-widest font-bold">Temps de r√©servation</div>
                <div class="text-5xl font-bold text-white digital-timer mb-2" id="digitalTimer">01:00:00</div>
                <div class="text-lg font-bold text-blue-400" id="digitalCost">CHF 4.00</div>
            </div>

            <!-- Action Buttons -->
            <div class="grid grid-cols-2 gap-4">
                <button onclick="reserveParking()" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-4 rounded-2xl transition shadow-sm">
                    üóìÔ∏è R√©server
                </button>
                <button onclick="startParking()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl transition shadow-lg shadow-blue-200">
                    üÖøÔ∏è D√©marrer
                </button>
            </div>
        </div>

        <!-- Reservation Status (Hidden by default) -->
        <div id="activeReservation" class="hidden bg-green-600 rounded-3xl p-6 text-white shadow-xl space-y-4">
            <div class="flex justify-between items-center">
                <h3 class="font-bold text-xl">‚úÖ Session Active</h3>
                <span class="bg-white/20 px-3 py-1 rounded-full text-xs font-bold">GE 12345</span>
            </div>
            <div class="text-center py-4">
                <div class="text-5xl font-bold digital-timer" id="activeTimer">00:59:59</div>
                <p class="text-green-100 mt-2">Fin pr√©vue √† 16:30</p>
            </div>
            <div class="flex gap-3">
                <button onclick="extendParking()" class="flex-1 bg-white/20 hover:bg-white/30 py-3 rounded-xl font-bold">Prolonger</button>
                <button onclick="stopParking()" class="flex-1 bg-red-500 hover:bg-red-600 py-3 rounded-xl font-bold">Terminer</button>
            </div>
        </div>

    </main>

    <!-- Navigation Footer -->
    <nav class="bg-white border-t flex justify-around p-3">
        <button class="flex flex-col items-center text-blue-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
            </svg>
            <span class="text-[10px] font-bold mt-1">CARTE</span>
        </button>
        <button class="flex flex-col items-center text-gray-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="text-[10px] font-bold mt-1">HISTORIQUE</span>
        </button>
        <button class="flex flex-col items-center text-gray-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            <span class="text-[10px] font-bold mt-1">PROFIL</span>
        </button>
    </nav>
</div>

<script>
const firebaseConfig = {authDomain: "swisspark-e4c0a.firebaseapp.com", projectId: "swisspark-e4c0a", apiKey: "AIzaSyB3uDEtxEcwxuRRqItU1G-sn5cAWse-gpc", storageBucket: "swisspark-e4c0a.firebasestorage.app", messagingSenderId: "852079002086", appId: "1:852079002086:web:d9d1f6c4e8b5a3c2d4e5f6"};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

let map;
let selectedMinutes = 60;
const pricePerHour = 4.00;

window.onload = function() {
    // Initialiser la Map (ICP Style)
    map = L.map('map').setView([46.2044, 6.1432], 14); // Gen√®ve
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);
    
    // Fix pour afficher la carte correctement
    setTimeout(function() {
        if (map) {
            map.invalidateSize();
        }
    }, 100);

    // Ajouter des marqueurs de parking
    const parkings = [
        { lat: 46.2044, lng: 6.1432, name: "Zone 1200 - Centre" },
        { lat: 46.2100, lng: 6.1450, name: "Zone 1201 - Gare" },
        { lat: 46.2000, lng: 6.1300, name: "Zone 1202 - Plainpalais" }
    ];

    parkings.forEach(p => {
        L.marker([p.lat, p.lng]).addTo(map).bindPopup(p.name);
    });

    // Auth
    auth.onAuthStateChanged((user) => {
        if (user) {
            document.getElementById('userPhone').textContent = user.phoneNumber || 'Connect√©';
        } else {
            window.location.href = '/swisspark-web/';
        }
    });

    updateDigitalDisplay();
};

function setDigitalTime(mins) {
    selectedMinutes = mins;
    // Update active class on buttons
    document.querySelectorAll('.num-button').forEach(btn => btn.classList.remove('active'));
    document.getElementById('btn-' + mins).classList.add('active');
    updateDigitalDisplay();
}

function updateDigitalDisplay() {
    const hours = Math.floor(selectedMinutes / 60);
    const mins = selectedMinutes % 60;
    const timeStr = String(hours).padStart(2, '0') + ":" + String(mins).padStart(2, '0') + ":00";
    document.getElementById('digitalTimer').textContent = timeStr;
    const cost = (selectedMinutes / 60 * pricePerHour).toFixed(2);
    document.getElementById('digitalCost').textContent = 'CHF ' + cost;
}

function reserveParking() {
    alert('üìÖ R√©servation num√©rique confirm√©e pour ' + selectedMinutes + ' minutes.
Vous recevrez une notification 10min avant.');
}

function startParking() {
    document.getElementById('activeReservation').classList.remove('hidden');
    document.getElementById('activeTimer').textContent = document.getElementById('digitalTimer').textContent;
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
}

function stopParking() {
    if(confirm('Terminer la session num√©rique?')) {
        document.getElementById('activeReservation').classList.add('hidden');
    }
}

function extendParking() {
    alert('‚ûï 15 minutes ajout√©es √† votre session num√©rique.');
}

function logout() {
    auth.signOut().then(() => { window.location.href = '/swisspark-web/'; });
}
</script>
</body>
</html>
